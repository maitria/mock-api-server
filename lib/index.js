// Generated by CoffeeScript 2.0.0-beta7
void function () {
  var child_process, Dsl, httpSync, MockApi;
  child_process = require('child_process');
  Dsl = require('./dsl');
  httpSync = require('http-sync-4');
  MockApi = function () {
    function MockApi(param$) {
      var instance$;
      instance$ = this;
      this._addResponseSpecification = function (a) {
        return MockApi.prototype._addResponseSpecification.apply(instance$, arguments);
      };
      this.options = param$;
    }
    MockApi.prototype.start = function (done) {
      var args;
      args = [
        '--port',
        this.options.port
      ];
      if (!this.options.logToConsole)
        args.push('--no-log-to-console');
      if (this.options.logToFile) {
        args.push('--log-to-file');
        args.push(this.options.logToFile);
      }
      child_process.spawn('' + __dirname + '/../bin/mock-api-server', args);
      return setTimeout(done, 500);
    };
    MockApi.prototype.stop = function () {
      return this._sendCommand('stop');
    };
    MockApi.prototype.reset = function () {
      return this._sendCommand('reset');
    };
    MockApi.prototype.respondTo = function (args) {
      args = 1 <= arguments.length ? [].slice.call(arguments, 0) : [];
      return new Dsl(this._addResponseSpecification, args);
    };
    MockApi.prototype._addResponseSpecification = function (spec) {
      var request;
      request = httpSync.request({
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        port: this.options.port,
        body: JSON.stringify(spec),
        path: '/mock-api/add-response'
      });
      return request.end();
    };
    MockApi.prototype._sendCommand = function (name) {
      var request;
      request = httpSync.request({
        method: 'GET',
        port: this.options.port,
        path: '/mock-api/' + name
      });
      return request.end();
    };
    return MockApi;
  }();
  module.exports = MockApi;
}.call(this);
